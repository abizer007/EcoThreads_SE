<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EcoThreads ‚Äî Sustainable Fashion Marketplace</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Local stylesheet (I'll provide next) -->
  <link rel="stylesheet" href="styles.css">

  <!-- Small helper for icons (optional) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-y..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Supabase client (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
</head>
<body>
  <!-- HEADER / NAV -->
  <header class="site-header">
    <div class="brand">
      <div class="leaf">üåø</div>
      <div class="brand-text">
        <div class="title">EcoThreads</div>
        <div class="subtitle">Sustainable fashion</div>
      </div>
    </div>

    <nav class="site-nav" aria-label="Primary">
      <a href="index.html" class="nav-link">Home</a>
      <a href="men.html" class="nav-link">Men's Fashion</a>
      <a href="women.html" class="nav-link">Women's Fashion</a>
      <a href="kids.html" class="nav-link">Kids' Clothing</a>
      <a href="#sell" class="nav-link">Sell</a>
      <a href="#about" class="nav-link">About</a>
    </nav>

    <div class="header-controls">
      <div class="search-box" role="search" aria-label="Search">
        <input id="searchInput" placeholder="Search for clothes..." aria-label="Search input">
        <button id="searchBtn" title="Search" class="icon-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>

      <button id="authBtn" class="btn outline">Sign In</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-left">
      <h1>Sustainable Fashion for a <span class="accent">Better Tomorrow</span></h1>
      <p class="lead">Give your clothes a second life. Buy, sell, or donate pre-loved fashion and help reduce textile waste while building a sustainable community.</p>

      <div class="hero-ctas">
        <button id="startShop" class="btn primary">Start Shopping <span class="arrow">‚ûú</span></button>
        <button id="openSell" class="btn outline">Sell or Donate</button>
      </div>

      <div class="hero-badges">
        <span class="dot green"></span>
        <span class="dot blue"></span>
        <span class="dot yellow"></span>
        <span class="dot red">+</span>
        <span class="stats-text">Join 1,00,000+ eco-conscious fashion lovers across India</span>
      </div>
    </div>

    <figure class="hero-right">
      <img alt="Sustainable fashion" src="image_2025-10-28_221220138.png">
    </figure>
  </section>

  <!-- CATEGORIES -->
  <section id="categories" class="section">
    <h2 class="section-title">Browse by Category</h2>
    <p class="section-sub">Discover unique, pre-loved fashion pieces across all categories. Every purchase helps reduce textile waste.</p>

    <div class="category-grid">
      <a href="men.html" class="category-card animate-up">
        <img src="https://images.unsplash.com/photo-1517423440428-a5a00ad493e8?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=28a0b1f7a9f3b9a" alt="Men's fashion">
        <div class="card-meta">
          <div class="card-title">Men's Fashion</div>
          <div class="card-sub">23,400 items</div>
        </div>
      </a>

      <a href="women.html" class="category-card animate-up delay-1">
        <img src="https://images.unsplash.com/photo-1542060747-2b3d8f1d2d81?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=ad6d9b1a" alt="Women's fashion">
        <div class="card-meta">
          <div class="card-title">Women's Fashion</div>
          <div class="card-sub">35,600 items</div>
        </div>
      </a>

      <a href="kids.html" class="category-card animate-up delay-2">
        <img src="https://images.unsplash.com/photo-1546182990-dffeafbe841d?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=4d1f0c" alt="Kids clothing">
        <div class="card-meta">
          <div class="card-title">Kids' Clothing</div>
          <div class="card-sub">18,900 items</div>
        </div>
      </a>

      <a href="#" class="category-card animate-up delay-3">
        <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=b5d6f2" alt="Accessories">
        <div class="card-meta">
          <div class="card-title">Accessories</div>
          <div class="card-sub">9,800 items</div>
        </div>
      </a>
    </div>
  </section>

  <!-- SELL FORM (small preview) -->
  <!-- REPLACE your existing <section id="sell">...</section> with this block -->
<section id="sell" class="section light">
  <style>
    /* Scoped styles for the sell/listing card to avoid global collisions */
    #sell { padding-top: 10px; padding-bottom: 40px; }
    #sell .listing-wrapper { max-width: 1180px; margin: 18px auto; padding: 0 18px; }
    #sell .listing-card{
      background:#fff;border-radius:16px;padding:22px;box-shadow:0 18px 40px rgba(12,30,20,0.06);
      display:flex;gap:22px;align-items:flex-start;justify-content:space-between;
    }
    #sell .col{flex:1;min-width:280px}
    #sell .col.right{width:420px;min-width:320px}
    #sell .list-card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    #sell .list-card-title{font-weight:700;color:#10a75a;display:flex;align-items:center;gap:10px}
    #sell .label{font-weight:700;color:#64707a;font-size:13px;margin-bottom:6px;display:block}
    #sell .field{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(15,23,32,0.06);background:#fbfcfd;font-size:14px}
    #sell textarea.field{min-height:140px;resize:vertical;padding:14px}
    #sell .form-row{display:flex;gap:12px;margin-top:12px}
    #sell .field.small{width:150px}
    #sell .muted{color:#9aa6a0;font-size:13px}
    /* donate NGO area */
    #sell .ngo-select{display:none;margin-top:12px}
    /* dropbox */
    #sell .dropbox{
      border:2px dashed rgba(15,23,32,0.08);border-radius:12px;padding:18px;text-align:center;
      min-height:150px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;position:relative;
      background:linear-gradient(180deg, rgba(250,252,250,0.9), rgba(255,255,255,0.98));
    }
    #sell .dropbox.dragover{background:linear-gradient(180deg, rgba(240,255,245,0.95), rgba(255,255,255,1));border-color:rgba(16,167,90,0.5)}
    #sell .btn-choose{background:linear-gradient(180deg,#e9fff0,#dff7e6);border-radius:24px;padding:8px 14px;border:0;color:#10a75a;font-weight:700;cursor:pointer}
    #sell .thumbs{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;justify-content:center}
    #sell .thumb{width:72px;height:72px;border-radius:8px;overflow:hidden;border:1px solid rgba(15,23,32,0.06);display:flex;align-items:center;justify-content:center;background:#fff}
    #sell .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    #sell .actions{display:flex;justify-content:flex-end;margin-top:18px}
    #sell .submit-btn{background:linear-gradient(180deg,#10a75a,#0d8b46);color:white;border:0;padding:12px 18px;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:0 10px 24px rgba(16,167,90,0.12)}
    #sell .submit-btn[disabled]{opacity:0.6;cursor:not-allowed}
    #sell .hidden{display:none!important}
    @media (max-width:980px){
      #sell .listing-card{flex-direction:column}
      #sell .col.right{width:100%}
    }
  </style>

  <div class="listing-wrapper">
    <form id="listForm" class="listing-card" autocomplete="off" enctype="multipart/form-data" novalidate>
      <!-- LEFT column -->
      <div class="col left">
        <div class="list-card-top">
          <div class="list-card-title">‚¨ÜÔ∏è List Your Item</div>

          <div style="text-align:right;min-width:260px">
            <div class="label" style="margin-bottom:6px">What would you like to do?</div>
            <div style="display:flex;align-items:center;gap:14px">
              <label style="display:inline-flex;align-items:center;gap:8px;font-weight:700;color:#3b5560">
                <input type="radio" name="mode" value="sell" checked> <span style="margin-left:6px;color:#0d8b46">‚Çπ Sell for Money</span>
              </label>
              <label style="display:inline-flex;align-items:center;gap:8px;font-weight:700;color:#3b5560">
                <input type="radio" name="mode" value="donate"> <span style="margin-left:6px;color:#ff3b5c">‚ô° Donate for Free</span>
              </label>
            </div>
          </div>
        </div>

        <div>
          <label class="label" for="title">Item Title</label>
          <input id="title" name="title" class="field" placeholder="e.g., Vintage Denim Jacket" required>
        </div>

        <div style="margin-top:12px">
          <label class="label" for="category">Category</label>
          <select id="category" name="category" class="field" required>
            <option value="Men">Men's Fashion</option>
            <option value="Women">Women's Fashion</option>
            <option value="Kids">Kids' Clothing</option>
            <option value="Accessories">Accessories</option>
          </select>
        </div>

        <div class="form-row" style="margin-top:12px">
          <div style="flex:1">
            <label class="label" for="size">Size</label>
            <input id="size" name="size" class="field" placeholder="e.g., M, L, XL">
          </div>

          <div style="width:170px">
            <label class="label" for="condition">Condition</label>
            <select id="condition" name="condition" class="field">
              <option>New</option>
              <option>Like New</option>
              <option>Good</option>
              <option>Fair</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="label" for="price">Price (‚Çπ)</label>
          <div style="display:flex;gap:12px;align-items:center">
            <input id="price" name="price" class="field small" placeholder="500" type="number" min="0" step="1">
            <div class="muted" style="font-weight:600">Enter amount only if selling</div>
          </div>
        </div>

        <div id="ngoWrap" class="ngo-select">
          <label class="label" for="ngo">Donate to NGO</label>
          <select id="ngo" name="ngo" class="field">
            <option value="">Choose an NGO (optional)</option>
            <option value="helping-hands">Helping Hands Foundation</option>
            <option value="care-for-all">Care For All</option>
            <option value="cloth-bridge">Cloth Bridge Initiative</option>
            <option value="local-collection">Local Collection Drive</option>
          </select>
          <div class="muted" style="margin-top:8px">We coordinate pickup & delivery to partner NGOs in your city (we'll confirm via email).</div>
        </div>
      </div>

      <!-- RIGHT column -->
      <div class="col right">
        <label class="label" for="description">Description</label>
        <textarea id="description" name="description" class="field" placeholder="Describe your item, its condition, and any special details..."></textarea>

        <div style="margin-top:12px">
          <label class="label">Photos <span class="muted" style="font-weight:600">(up to 5)</span></label>

          <div id="dropbox" class="dropbox" aria-describedby="photoHint">
            <div style="font-size:22px;color:#64707a">üì∑</div>
            <div id="photoHint" class="muted"><strong>Click to upload or drag and drop</strong></div>
            <div class="muted">PNG, JPG up to 10MB each</div>
            <div style="margin-top:10px">
              <button type="button" id="chooseBtn" class="btn-choose">Choose Files</button>
            </div>

            <input id="photos" name="photos" type="file" accept="image/*" multiple class="hidden" aria-hidden="true">
            <div id="thumbs" class="thumbs" aria-live="polite"></div>
          </div>
        </div>

        <div class="actions">
          <button id="submitBtn" class="submit-btn" type="button">List for Sale</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    (function () {
      // Elements
      const form = document.getElementById('listForm');
      const radios = Array.from(form.querySelectorAll('input[name="mode"]'));
      const ngoWrap = document.getElementById('ngoWrap');
      const priceInput = document.getElementById('price');
      const submitBtn = document.getElementById('submitBtn');
      const photosInput = document.getElementById('photos');
      const chooseBtn = document.getElementById('chooseBtn');
      const dropbox = document.getElementById('dropbox');
      const thumbs = document.getElementById('thumbs');

      // Limits
      const MAX_FILES = 5;
      const MAX_BYTES = 10 * 1024 * 1024; // 10MB

      // Helper to show thumbnails
      function renderThumbnails(files) {
        thumbs.innerHTML = '';
        Array.from(files).forEach(f => {
          const reader = new FileReader();
          const wrap = document.createElement('div'); wrap.className = 'thumb';
          reader.onload = function (e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            wrap.appendChild(img);
          };
          reader.readAsDataURL(f);
          thumbs.appendChild(wrap);
        });
      }

      // Toggle donate/sell UI
      function updateModeUI() {
        const mode = form.querySelector('input[name="mode"]:checked').value;
        if (mode === 'donate') {
          ngoWrap.style.display = 'block';
          priceInput.disabled = true;
          priceInput.value = '';
          submitBtn.textContent = 'Donate';
        } else {
          ngoWrap.style.display = 'none';
          priceInput.disabled = false;
          submitBtn.textContent = 'List for Sale';
        }
      }

      radios.forEach(r => r.addEventListener('change', updateModeUI));
      updateModeUI();

      // File selection
      chooseBtn.addEventListener('click', () => photosInput.click());
      photosInput.addEventListener('change', () => {
        const files = photosInput.files;
        if (files.length > MAX_FILES) {
          alert('You can upload up to ' + MAX_FILES + ' images.');
          photosInput.value = '';
          thumbs.innerHTML = '';
          return;
        }
        for (let i = 0; i < files.length; i++) {
          if (files[i].size > MAX_BYTES) {
            alert(files[i].name + ' is larger than 10MB.');
            photosInput.value = '';
            thumbs.innerHTML = '';
            return;
          }
        }
        renderThumbnails(files);
      });

      // Drag & drop
      dropbox.addEventListener('dragover', (e) => {
        e.preventDefault(); dropbox.classList.add('dragover');
      });
      dropbox.addEventListener('dragleave', (e) => {
        e.preventDefault(); dropbox.classList.remove('dragover');
      });
      dropbox.addEventListener('drop', (e) => {
        e.preventDefault(); dropbox.classList.remove('dragover');
        const dt = e.dataTransfer;
        if (!dt) return;
        const files = Array.from(dt.files).filter(f => f.type.startsWith('image/'));
        if (files.length === 0) return;
        if (files.length > MAX_FILES) { alert('You can upload up to ' + MAX_FILES + ' images.'); return; }
        for (let f of files) {
          if (f.size > MAX_BYTES) { alert(f.name + ' is larger than 10MB.'); return; }
        }
        // Put them into the file input (works in modern browsers)
        const dataTransfer = new DataTransfer();
        files.forEach(f => dataTransfer.items.add(f));
        photosInput.files = dataTransfer.files;
        renderThumbnails(photosInput.files);
      });

      // Prepare payload and upload
      async function handleSubmit() {
        // Basic validation
        const title = form.title.value.trim();
        const category = form.category.value;
        const size = form.size.value.trim();
        const condition = form.condition.value;
        const price = form.price.value;
        const description = form.description.value.trim();
        const isDonation = form.querySelector('input[name="mode"]:checked').value === 'donate';
        const donationOrg = form.ngo.value || null;
        const files = photosInput.files || [];

        if (!title) { alert('Please enter item title'); return; }
        if (!category) { alert('Please select category'); return; }
        if (!isDonation && (!price || Number(price) <= 0)) {
          if (!confirm('Price is empty or zero ‚Äî continue listing without a price?')) return;
        }

        // Build metadata object
        const item = {
          title,
          category,
          size,
          condition,
          price: isDonation ? 0 : (price ? Number(price) : 0),
          description,
          is_donation: isDonation,
          donation_org: donationOrg,
          photos: [] // will be filled with URLs if uploaded
        };

        submitBtn.disabled = true;
        const origText = submitBtn.textContent;
        submitBtn.textContent = isDonation ? 'Donating...' : 'Listing...';

        // If supabase client exists, attempt to upload images and insert
        const supabaseClient = window.supabaseClient || null;

        try {
          if (supabaseClient && supabaseClient.storage && supabaseClient.from) {
            // require auth
            const uResp = await supabaseClient.auth.getUser();
            const user = uResp && uResp.data ? uResp.data.user : null;
            if (!user) {
              alert('Please sign in to list or donate an item.'); // you can open modal here
              submitBtn.disabled = false;
              submitBtn.textContent = origText;
              return;
            }

            // upload files
            for (let i = 0; i < files.length; i++) {
              const file = files[i];
              const safeName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
              const path = `items/${user.id}/${safeName}`;

              const { data: uploadData, error: uploadError } = await supabaseClient.storage.from('items').upload(path, file, { cacheControl: '3600', upsert: false });
              if (uploadError) {
                console.error('Upload error', uploadError);
                throw uploadError;
              }
              // get public url
              const publicData = supabaseClient.storage.from('items').getPublicUrl(path);
              const publicUrl = (publicData && (publicData.publicURL || publicData.publicUrl)) ? (publicData.publicURL || publicData.publicUrl) : null;
              item.photos.push(publicUrl);
            }

            // insert into DB
            const insert = {
              title: item.title,
              category: item.category,
              size: item.size,
              condition: item.condition,
              price: item.price,
              description: item.description,
              photos: item.photos,
              is_donation: item.is_donation,
              donation_org: item.donation_org,
              user_id: (await supabaseClient.auth.getUser()).data.user.id
            };

            const { data: insertData, error: insertError } = await supabaseClient.from('items').insert([insert]);
            if (insertError) { throw insertError; }

            alert(isDonation ? 'Thank you ‚Äî donation listed. We will contact you about pickup.' : 'Item listed successfully!');
            // reset form
            form.reset();
            thumbs.innerHTML = '';
            updateModeUI(); // reset UI
          } else {
            // Supabase not configured: just log prepared payload and simulate success
            console.log('Prepared item (no supabase):', item);
            alert('Preview: prepared payload logged to console. (Supabase not configured)');
            form.reset();
            thumbs.innerHTML = '';
            updateModeUI();
          }
        } catch (err) {
          console.error(err);
          alert((err && err.message) || 'Failed to submit listing. See console for details.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = origText;
        }
      }

      submitBtn.addEventListener('click', handleSubmit);

      // keyboard accessibility: Enter on price or title won't submit automatically, user must click button
      // Initialize UI (ensure correct state)
      function updateModeUI() {
        const modeEl = form.querySelector('input[name="mode"]:checked');
        const mode = modeEl ? modeEl.value : 'sell';
        if (mode === 'donate') {
          ngoWrap.style.display = 'block';
          priceInput.disabled = true;
          submitBtn.textContent = 'Donate';
        } else {
          ngoWrap.style.display = 'none';
          priceInput.disabled = false;
          submitBtn.textContent = 'List for Sale';
        }
      }
      // ensure updateModeUI scope has ngoWrap reference:
      radiosArray = Array.from(form.querySelectorAll('input[name="mode"]'));
      radiosArray.forEach(r => r.addEventListener('change', updateModeUI));
      updateModeUI(); // first-run
    })();
  </script>
</section>


  <!-- PAYMENTS | REVIEWS simplified preview -->
  <section id="trust" class="section">
    <h2 class="section-title center">Community Reviews & Trust</h2>
    <div class="stats-row">
      <div class="stat-card">4.9 <div class="muted small">Average Rating</div></div>
      <div class="stat-card">1,58,470 <div class="muted small">Total Reviews</div></div>
      <div class="stat-card">98% <div class="muted small">Positive Feedback</div></div>
      <div class="stat-card">24h <div class="muted small">Avg Response Time</div></div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="brand-col">
        <div class="title white">EcoThreads</div>
        <p class="muted">Building a sustainable fashion community through buying, selling, and donating pre-loved clothing.</p>
      </div>

      <div class="links-col">
        <div><strong>Shop</strong><br>Men's Fashion<br>Women's Fashion<br>Kids' Clothing</div>
        <div><strong>Sell & Donate</strong><br>How to Sell<br>Donation Program</div>
        <div><strong>Support</strong><br>Help Center<br>Contact Us</div>
      </div>
    </div>
    <div class="footer-bottom muted">¬© 2025 EcoThreads. All rights reserved.</div>
  </footer>

  <!-- AUTH MODAL -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <h3 id="modalTitle">Welcome to EcoThreads</h3>
        <button id="closeModal" aria-label="Close" class="icon-btn"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="modal-tabs">
        <button id="tabSignIn" class="tab active">Sign In</button>
        <button id="tabSignUp" class="tab">Sign Up</button>
      </div>

      <div id="authForms">
        <div id="signInForm">
          <input id="signinEmail" class="field" placeholder="Email">
          <input id="signinPassword" type="password" class="field" placeholder="Password">
          <button id="btnSignIn" class="btn primary">Sign In</button>
        </div>

        <div id="signUpForm" style="display:none;">
          <input id="signupEmail" class="field" placeholder="Email">
          <input id="signupPassword" type="password" class="field" placeholder="Password">
          <button id="btnSignUp" class="btn primary">Create Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- App script (I'll provide next) -->
  <script>
    // placeholder: clients must replace with their Supabase project values
    const SUPABASE_URL = 'https://gymhmmkiwdtzodwwmrtu.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5bWhtbWtpd2R0em9kd3dtcnR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NjU4MTEsImV4cCI6MjA3NzI0MTgxMX0.Mm_tytWQP_cH0Bb9Swmwrk0jEBG3zrL7XfFViCu1o44';

    // create client and attach to window so other scripts can use it
    // use window.supabase (UMD) to create client instance
    window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <script src="app.js" defer></script>
</body>
</html>
